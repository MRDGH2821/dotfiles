#!/usr/bin/env bash

# Native packages

## Debian

if type -P nala &>/dev/null; then
  sudo nala install --update -y -o APT::Get::AllowUnauthenticated=true {{ range .packages.linux.nala }} {{.}}{{ end }}
  sudo nala install --update -y -o APT::Get::AllowUnauthenticated=true {{ range .packages.linux.nala_url }}{{. | quote}} {{ end }}

  if [[ $XDG_SESSION_DESKTOP == "KDE" ]]; then
    sudo nala install --update -y -o APT::Get::AllowUnauthenticated=true {{ range .packages.linux.kde }} {{.}}{{ end }}
  fi
fi


## Fedora

if type -P dnf5 &>/dev/null; then
  sudo dnf5 install -y {{ range .packages.linux.dnf5 }} {{.}}{{ end }}
  {{ range .packages.linux.dnf5_url }}
  sudo dnf5 install -y {{ . | quote }}
  {{ end }}

  if [[ $XDG_SESSION_DESKTOP == "KDE" ]]; then
    sudo dnf5 install -y {{ range .packages.linux.kde }} {{.}}{{ end }}
  fi
fi

## Arch

if type -P yay &>/dev/null; then
  sudo yay -Syu {{ range .packages.linux.yay }} {{.}}{{end}}

  if [[ $XDG_SESSION_DESKTOP == "KDE" ]]; then
    sudo yay -Syu {{ range .packages.linux.kde }} {{.}}{{ end }}
  fi

# Flatpak

flatpak install --user -y {{ range .packages.linux.flatpak }} {{.}}{{ end }}


# Linux self installing packages

{{ range .packages.linux.linux_url }}
bash -c {{ . | quote }}
{{ end }}

# Python3 packages

pip install pipx
pipx install {{ range .packages.python3.pipx }} {{.}}{{ end }}

# Executables from GitHub

## Binaries

{{ range .packages.linux.dra_bin }}
dra download -a -o "$HOME"/.local/bin/ -i {{.}}
{{ end }}

if type -P nala &>/dev/null; then
  {{ range .packages.linux.dra_deb_rpm }}
  dra download -a -o "$HOME"/.local/bin/ -i {{.}}
  {{ end }}

  # Install deb packages
  {{ range .packages.linux.dra_deb }}
  dra download -a -o "$HOME"/.local/bin/ -i {{.}}
  {{ end }}

fi

if type -P dnf5 &>/dev/null; then
  {{ range .packages.linux.dra_deb_rpm }}
  dra download -a -o "$HOME"/.local/bin/ -i {{.}}
  {{ end }}
fi

## Appimages
{{ range .packages.linux.dra_appimage }}
dra download -a -o "$HOME"/AppImages -i {{.}}
{{ end }}
