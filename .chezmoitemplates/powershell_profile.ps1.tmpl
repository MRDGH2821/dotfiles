{{- if ne .chezmoi.os "windows" }}
# Add ~/.local/bin to PATH for Linux
$env:PATH = "$HOME/.local/bin:$env:PATH"
{{- end }}

# Oh my posh random theme initializer
# Select a random theme
{{- if eq .chezmoi.os "windows" }}

$package = Get-AppxPackage -Name ohmyposh.cli
$installLocation = $package.InstallLocation

# Define potential theme directories (not globs)
$themeDirs = @(
  "$env:UserProfile\AppData\Local\Programs\oh-my-posh\themes"
  "$env:UserProfile\.oh-my-posh\themes"
  Join-Path $installLocation "themes"
)

$validJsonFiles = @()

foreach ($dir in $themeDirs) {
  if (Test-Path $dir) {
    $jsonFiles = Get-ChildItem -Path $dir -Filter '*.json' -File -ErrorAction SilentlyContinue
    if ($jsonFiles.Count -gt 0) {
      $validJsonFiles = $jsonFiles
      break
    }
  }
}

$theme = Get-Random -InputObject $validJsonFiles

{{- else }}
$theme = Get-ChildItem ~/.cache/oh-my-posh/themes/*.json | Get-Random
{{- end }}

Write-Output $theme.name
# Set the theme
oh-my-posh --init --shell pwsh --config $theme.FullName | Invoke-Expression

# Import the Chocolatey Profile that contains the necessary code to enable
# tab-completions to function for `choco`.
# Be aware that if you are missing these lines from your profile, tab completion
# for `choco` will not function.
# See https://ch0.co/tab-completion for details.
$ChocolateyProfile = "$env:ChocolateyInstall\helpers\chocolateyProfile.psm1"
if (Test-Path($ChocolateyProfile)) {
  Import-Module "$ChocolateyProfile"
}

# Fast node Manager
fnm env --use-on-cd --shell power-shell | Out-String | Invoke-Expression

# Zoxide
Invoke-Expression (& { (zoxide init powershell --cmd cd | Out-String) })

{{- if eq .chezmoi.os "windows" }}
# Aliases
Remove-Item Alias:cat -Force
Set-Alias -Name cat -Value bat
{{- end }}

# McFly

Invoke-Expression -Command $(mcfly init powershell | out-string)
